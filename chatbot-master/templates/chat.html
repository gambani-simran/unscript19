
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HealthMate</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/chat.css">
</head>

<body>
<div class="page-wrapper chiller-theme toggled">
  <a id="show-sidebar" class="btn btn-sm btn-dark" href="#">
    <i class="fas fa-bars"></i>
  </a>
  <nav id="sidebar" class="sidebar-wrapper">
    <div class="sidebar-content">
      <div class="sidebar-brand">
        <a href="#">pro sidebar</a>
        <div id="close-sidebar">
          <i class="fas fa-times"></i>
        </div>
      </div>
      <div class="sidebar-header">
        <div class="user-pic">
          <img class="img-responsive img-rounded" src="https://raw.githubusercontent.com/azouaoui-med/pro-sidebar-template/gh-pages/src/img/user.jpg"
            alt="User picture">
        </div>
        <div class="user-info">
          <span class="user-name">Jhon
            <strong>Smith</strong>
          </span>
          <span class="user-role">Administrator</span>
          <span class="user-status">
            <i class="fa fa-circle"></i>
            <span>Online</span>
          </span>
        </div>
      </div>
      <!-- sidebar-header  -->
      <div class="sidebar-menu">
        <ul>
          <li class="header-menu">
            <span>General</span>
          </li>
          <li>
                <a href="#">
                  <i class="fa fa-calendar"></i>
                  <span>Calendar</span>
                </a>
              </li>
          <li class="sidebar-dropdown">
            <a href="#">
              <i class="fas fa-clock"></i>
              <span>Prescriptions</span>
              <span class="badge badge-pill badge-warning">New</span>
            </a>
            <div class="sidebar-submenu">
              <ul>
                <li>
                  <a href="#">Med 1 - Time 1
                  </a>
                </li>
                <li>
                  <a href="#">Med 2 - Time 2</a>
                </li>
                <li>
                  <a href="#" ref="#">Med 3 - Time 3</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="sidebar-dropdown">
            <a href="#">
              <i class="fa fa-universal-access"></i>
              <span>Exercises</span>
              <span class="badge badge-pill badge-danger">3</span>
            </a>
            <div class="sidebar-submenu">
              <ul>
                <li>
                  <a href="#">Products
                  </a>
                </li>
                <li>
                  <a href="#">Orders</a>
                </li>
                <li>
                  <a href="#">Credit cart</a>
                </li>
              </ul>
            </div>
          </li>
        </ul>
      </div>
      <!-- sidebar-menu  -->
    </div>
    <!-- sidebar-content  -->
    <div class="sidebar-footer">
      <a href="#">
        <i class="fa fa-bell"></i>
        <span class="badge badge-pill badge-warning notification">3</span>
      </a>
      <a href="#">
        <i class="fa fa-envelope"></i>
        <span class="badge badge-pill badge-success notification">7</span>
      </a>
      <a href="#">
        <i class="fa fa-cog"></i>
        <span class="badge-sonar"></span>
      </a>
      <a href="#">
        <i class="fa fa-power-off"></i>
      </a>
    </div>
  </nav>
  <!-- sidebar-wrapper  -->
  <main class="page-content">
    <div class="container-fluid">
        <div id = "frame">
                <div class="content">
                        <div class="contact-profile">
                            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
                            <p>Harvey Specter</p>
                        </div>
                        <div class="messages">
                            <ul class="message-list">
                              {% for chat in final_chats %}
                                <li class="sent">
                                    <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
                                    <p>{{ chat[0] }}</p>
                                </li>
                                <li class="replies">
                                    <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
                                    <p>{{ chat[1] }}</p>
                                </li>
                              {% endfor %}
                            </ul>
                        </div>
                      <form method="post" id="chatbot-form">
                      <div class="message-input">
                          <div class="wrap">
                          <input type="text" name="messageText" placeholder="Write your message" id="messageText"/>
                          <i id="chatbot-form-btn-voice" class="fa fa-microphone attachment" aria-hidden="true"></i>
                          <button type="submit" id="chatbot-form-btn"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                          </div>
                      </div>
                      </form>
                    </div>
        </div>
    </div>

  </main>
  <!-- page-content" -->
</div>
<!-- page-wrapper -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script>
      var exports = {};
  </script>
  <script src="https://unpkg.com/speech-to-text@0.7.4/lib/index.js"></script>
  <script>
    $(function() {
        var synth = window.speechSynthesis;

        var msg = new SpeechSynthesisUtterance();
        var voices = synth.getVoices();
        msg.voice = voices[0];
        msg.rate = 1;
        msg.pitch = 1;
        $('#chatbot-form-btn-voice').click(function(e) {
            e.preventDefault();

            var onAnythingSaid = function (text) {
                console.log('Interim text: ', text);
            };
            var onFinalised = function (text) {
                console.log('Finalised text: ', text);
                $('#messageText').val(text);
            };
            var onFinishedListening = function () {
                $('#chatbot-form-btn').click();
            };

            try {
                var listener = new SpeechToText(onAnythingSaid, onFinalised, onFinishedListening);
                listener.startListening();

                setTimeout(function () {
                    listener.stopListening();
                    if ($('#messageText').val()) {
                        $('#chatbot-form-btn').click();
                    }
                }, 5000);
            } catch (error) {
                console.log(error);
            }
        });
    });
    </script>
    <script>
       $(".messages").animate({ scrollTop: $(document).height() }, "fast");
               
              function newMessage(type,message) {
                    if($.trim(message) == '') {
                        return false;
                    }
                    $('#message-list').append('<li class="'+ type +'"><img src="http://emilcarlsson.se/assets/mikeross.png" alt="" /><p>' + message + '</p></li>').appendTo($('.messages ul'));
                    $(".messages").animate({ scrollTop: $(document).height() }, "fast");
                };

                // $('#chatbot-form-btn').click(function(e) {
                //   message = $(".message-input input").val();
                //   e.preventDefault();
                //   newMessage('sent',message);
                //   // console.log("idhar aa rha hai "+ message);
                // });

                $('#chatbot-form').submit(function(e) {
                    e.preventDefault();
                    var message = $(".message-input input").val();
                    console.log(message);
                    console.log("in ajax call "+$('#chatbot-form').serialize().toString());
                    $('.message-list').append('<li class="sent"><img src="http://emilcarlsson.se/assets/mikeross.png" alt="" /><p>' + message + '</p></li>').appendTo($('.messages ul'));
                    $(".messages").animate({ scrollTop: $(document).height() }, "fast");
                    $.ajax({
                        type: "POST",
                        url: "/ask",
                        data: $('#chatbot-form').serialize(),
                        success: function(response) {
                            $('#messageText').val('');
                            var z = response.answer;
                            var x = typeof response.answer;
                            if(x === "undefined"){
                              console.log("SAyy");
                              z = "Waiting for Doctor's Approval";
                            }
                            $('.message-list').append('<li class="replies"><img src="http://emilcarlsson.se/assets/mikeross.png" alt="" /><p>' + z + '</p></li>').appendTo($('.messages ul'));
                            $(".messages").animate({ scrollTop: $(document).height() }, "fast");
                            //msg.text = answer;
                            //speechSynthesis.speak(msg);
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                });
        
                $(window).on('keydown', function(e) {
                if (e.which == 13) {
                    $('#chatbot-form').submit();
                    return false;
                }
                });

                var ajax_call = function() {
      //your jQuery ajax code
      $.ajax({
          type:'POST',
          url:'/sendnotif',
          success : function(resp){
            console.log(resp);
          },
          error:function(err){
            console.log(err);
          }
        });
      };
    </script>
</body>

</html>